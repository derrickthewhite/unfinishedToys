<!DOCTYPE html>
<html>
<head>
	<title>System Maker</title>
	<!--<link href="main.css" rel="stylesheet">-->
	<!--<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.1/knockout-debug.js"></script>
	<!--<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.0/knockout-min.js"></script>-->
	<script type="text/javascript" src= "../../Tools/knockout-3.4.0.js"></script>
	<script src="https://cdn.rawgit.com/konvajs/konva/1.6.5/konva.js"></script>
	<script type="text/javascript" src= "../../Tools/knockout-konva.js"></script>
	<script type="text/javascript" src= "main.js"></script>
	<script type="text/javascript" src= "planet.js"></script>
	<script type="text/javascript" src= "star.js"></script>
	<script type="text/javascript" src= "system.js"></script>
	<script >


		
		function Orbit ( distance, eccentricty, center){
			var orbit = {};
			
			orbit.eccentricty= ko.observable(eccentricty);
			orbit.distance = ko.observable(distance);
			orbit.center = ko.observable(center);
			
			orbit.minDistance = ko.pureComputed(()=>(1-orbit.eccentricty())*orbit.distance());
			orbit.maxDistance = ko.pureComputed(()=>(1+orbit.eccentricty())*orbit.distance());
			
			return orbit;
		}

		function load ()
		{
			var root = {};
			root.cosmos = {
				systems: ko.observableArray([])
			};
			root.events = {};
			
			for(var i =0;i< 100;i++)
			{
				root.cosmos.systems.push(generateSystem());
			}
			
			root.currentSystem = ko.observable(root.cosmos.systems()[0]);
			root.currentStar = ko.observable(root.currentSystem().stars()[0]);
			root.currentPlanet = ko.observable(root.currentSystem().planets()[0]);
			
			root.events.planetClick = function (data){root.currentPlanet(data)};
			root.events.starClick = function (data){root.currentStar(data)};
			root.events.systemClick = function (data){root.currentSystem(data)};
			
			ko.applyBindings(root,document.getElementById('content'));
		}
	</script>
</head>
<body onload="load()">
	<div id = "content">
		<div data-bind="with: currentStar">
			STAR <br>
			mass: <span data-bind="text:mass"></span><br>
			luminosity: <span data-bind="text:luminosity"></span><br>
			stage: <span data-bind="text:stage"></span><br>
			type: <span data-bind="text:size().starclass"></span><br>
			age: <span data-bind="text:mass"></span><br>
			radius: <span data-bind="text:radius"></span><br>
			Orbit: <span data-bind="text:orbit().minDistance"></span> to <span data-bind="text:orbit().maxDistance"></span> <br>
		</div>
		<div data-bind="with: currentPlanet">
			PLANET <br>
			size: <span data-bind="text:size"></span><br>
			type: <span data-bind="text:terrain"></span><br>
			blackbody: <span data-bind="text:blackBody"></span><br>
			temperature: <span data-bind="text:temperature"></span><br>
			gravity: <span data-bind="text:gravity"></span><br>
			diameter: <span data-bind="text:diameter"></span><br>
			ATMOSPHERE <br>
			mass: <span data-bind="text:atmosphere.mass"></span><br>
			toxicty: <span data-bind="text:atmosphere.toxicty"></span><br>
			<!-- ko if:terrain() =="Garden" -->
				Air Quality: <span data-bind="text:atmosphere.marginal"></span><br>
			<!-- /ko -->
			<!-- ko if:hydrographicCoverage -->
				Ocean Coverage: <span data-bind="text:hydrographicCoverage"></span><br>
			<!-- /ko -->
			orbit: <span data-bind="text:orbit().distance"></span><br>
		</div>
		<!-- ko Konva.Stage: {width: 800, height:800 } -->
			<!-- ko Konva.Layer: {} -->
				<!-- ko foreach:currentSystem().stars() -->
					<!-- ko Konva.Group: {x:0,y:Number($index()) * 100} -->
						<!-- ko Konva.Rect: {x:0, y:0, width: 800, height:100, fill:'black', stroke: 'black', strokeWidth: 0 } --> 
						<!-- /ko -->
						<!-- ko Konva.Circle: {x:50-drawnRadius(), y:50, radius:drawnRadius, fill:drawnColor, stroke: drawnColor, strokeWidth: 0, click: $root.events.starClick, data:$data} --> 
						<!-- /ko -->
						<!-- ko foreach:$root.currentSystem().planets -->
							<!-- ko if: $parent == $data.orbit().center()-->
								<!-- ko Konva.Circle: {x:viewDistance, y:50, radius:drawnRadius, fill:drawnColor, stroke: drawnColor, strokeWidth: 0, click: $root.events.planetClick, data:$data } -->
								<!-- /ko -->
							<!-- /ko -->
						<!-- /ko -->
						<!-- ko Konva.Line: {points:[$data.displayPosition($data.snowLine()),0,$data.displayPosition($data.snowLine()),100], stroke: "white", strokeWidth: 1} --> 
						<!-- /ko -->
						<!-- ko Konva.Line: {points:[$data.displayPosition($data.hotHabitableZone()),0,$data.displayPosition($data.hotHabitableZone()),100], stroke: "green", strokeWidth: 1} --> 
						<!-- /ko -->
						<!-- ko Konva.Line: {points:[$data.displayPosition($data.coldHabitableZone()),0,$data.displayPosition($data.coldHabitableZone()),100], stroke: "green", strokeWidth: 1} --> 
						<!-- /ko -->
					<!-- /ko -->
				<!-- /ko -->
				<!-- ko Konva.Group: {x:0,y:currentSystem().stars().length*100} -->
					<!-- ko Konva.Rect: {x:0, y:0, width: 500, height:500, fill:'black', stroke: 'black', strokeWidth: 0 } --> 
					<!-- /ko -->
					<!-- ko foreach:cosmos.systems -->
						<!-- ko Konva.Circle: {x:location.x()*5, y:location.y()*5, radius:2, fill:stars()[0].drawnColor, stroke: stars()[0].drawnColor, strokeWidth: 0, click: $root.events.systemClick, data:$data } -->
						<!-- /ko -->
						<!-- ko if:isHabitable -->
							<!-- ko Konva.Circle: {x:location.x()*5+5, y:location.y()*5+5, radius:1, fill:"green", stroke: "green", strokeWidth: 0} -->
							<!-- /ko -->
						<!-- /ko -->
					<!-- /ko -->
							<!-- ko Konva.Circle: {x:currentSystem().location.x()*5, y:currentSystem().location.y()*5, radius:15, fill:"rgba(0,0,0,0)", stroke: "white", strokeWidth: 1} -->
							<!-- /ko -->
				<!-- /ko -->
			<!-- /ko -->
		<!-- /ko -->
	</div>
</body>