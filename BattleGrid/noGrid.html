<html>
	<head>
		<title>Tank Battles </title>
		<script src = "https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.2/knockout-min.js"></script>
		<script src = "https://cdnjs.cloudflare.com/ajax/libs/konva/1.6.8/konva.min.js"></script>
		<script src = "konva-knockout.js"></script>
		<script>
			

			function load(){
				
				var combat = {};
				combat.units = ko.observableArray([]);
				
				combat.currentUnit = ko.observable();
				
				combat.locationClick = function(data,event) {
					console.log(combat.currentUnit());
					combat.currentUnit().x((event.evt.offsetX)/50);
					combat.currentUnit().y((event.evt.offsetY)/50);
				}
				combat.objectClick = function(data){
					combat.currentUnit(data);
				}
				
				for(var i =0;i<10;i++){
					combat.units.push(
					{
						x:ko.observable(Math.floor(Math.random()*10)),
						y:ko.observable(Math.floor(Math.random()*10))
					});
				}
				
				ko.applyBindings(combat);
			}
		</script>
	</head>
	<body onload="load()">
		<div>
			<!-- ko Konva.Stage: { width: 500, height: 500 } -->
				<!-- ko Konva.Layer: { } -->
					<!-- ko Konva.Rect: { x: 0, y: 0, width: 500, height: 500, fill: "teal", stroke: "black", strokeWidth: 2, click:$root.locationClick, data:$data} -->
					<!-- /ko -->
				<!-- /ko -->
				<!-- ko Konva.Layer: { } -->
					<!-- ko if:currentUnit -->
						<!-- ko Konva.Rect: { x: currentUnit().x()*50-15, y: currentUnit().y()*50-15, width: 30, height: 30, fill:"#ffffff", opacity: .5} -->
						<!-- /ko -->
					<!-- /ko -->
				<!-- /ko -->
				<!-- ko Konva.Layer: { } -->
					<!-- ko foreach: units -->
						<!-- ko Konva.Rect: { x: ko.pureComputed(()=>x()*50-10), y: y()*50-10, width: 20, height: 20, fill: "#ff0000", stroke: "black", strokeWidth: 2, click:$root.objectClick, data:$data} -->
						<!-- /ko -->
					<!-- /ko -->
				<!-- /ko -->
			<!-- /ko -->
		</div>
	</body>
</html>